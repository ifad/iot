<!doctype html>

<html>
  <head>
    <meta charset="utf-8">
    <title>Faye demo: chat client</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/faye.js"></script>
  </head>
  <body>

    <div class="container">
      <h1><em>Soapbox</em> | a Twitter-style chat app</h1>

      <form id="enterUsername">
        <label for="username">Username</label>
        <input type="text" name="username" id="username">
        <input type="submit" value="Go">
      </form>

      <div id="app">
        <form id="addFollowee">
          <label for="followee">Follow</label>
          <input type="text" name="followee" id="followee">
          <input type="submit" value="Follow">
        </form>

        <form id="postMessage">
          <label for="message">Post a message</label> <span id="transport"></span><br>
          <textarea name="message" id="message" rows="3" cols="40"></textarea>
          <input type="submit" value="Send">
        </form>

        <ul id="stream">
        </ul>
      </div>

      <script>
        Faye.logger = window.console;

        var client = new Faye.Client('http://localhost:3000/bayeux', {proxy: {headers: {'User-Agent': 'Faye'}}});

        var subscription = client.subscribe('/chat/*', function(message) {
          var user = message.user;

          var publication = client.publish('/members/' + user, {
            user:     'node-logger',
            message:  'ï£¿ Got your message, ' + user + '!'
          });
          publication.callback(function() {
            console.log('[PUBLISH SUCCEEDED]');
          });
          publication.errback(function(error) {
            console.log('[PUBLISH FAILED]', error);
          });
        });

        subscription.callback(function() {
          console.log('[SUBSCRIBE SUCCEEDED]');
        });
        subscription.errback(function(error) {
          console.log('[SUBSCRIBE FAILED]', error);
        });

        client.bind('transport:down', function() {
          console.log('[CONNECTION DOWN]');
        });
        client.bind('transport:up', function() {
          console.log('[CONNECTION UP]');
        });
      </script>
    </div>

  </body>
</html>
